<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Не баг, а фича — Знакомства для айтишников</title>
  <meta name="description" content="Сайт знакомств для разработчиков. Здесь твои баги — это фичи, а merge-конфликты — это страсть." />

  <style>
    :root {
      --bg: #0d1117;
      --text: #f0f6fc;
      --accent: #58a6ff;
      --card: #161b22;
      --border: #30363d;
      --green: #238636;
      --red: #da3633;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      background: var(--bg);
      color: var(--text);
      font-family: 'Inter', sans-serif;
      line-height: 1.6;
      overflow-x: hidden;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 20px;
    }

    /* Header */
    header {
      padding: 2rem 0;
      text-align: center;
      border-bottom: 1px solid var(--border);
    }

    .logo {
      font-family: 'JetBrains Mono', monospace;
      font-size: 2.5rem;
      font-weight: 700;
      color: var(--accent);
      text-shadow: 0 0 10px rgba(88, 166, 255, 0.5);
    }

    .logo span {
      color: var(--green);
    }

    .tagline {
      margin-top: 0.5rem;
      font-size: 1.1rem;
      color: #8b949e;
    }

    /* Hero */
    .hero {
      text-align: center;
      padding: 4rem 0;
    }

    .hero h1 {
      font-size: 3rem;
      margin-bottom: 1rem;
      background: linear-gradient(90deg, var(--accent), #a5d8ff);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    .hero p {
      font-size: 1.3rem;
      max-width: 700px;
      margin: 0 auto 2rem;
      color: #c9d1d9;
    }

    .btn {
      display: inline-block;
      padding: 14px 32px;
      background: var(--accent);
      color: white;
      text-decoration: none;
      border-radius: 8px;
      font-weight: 600;
      transition: all 0.3s;
      margin: 0.5rem;
      box-shadow: 0 4px 12px rgba(88, 166, 255, 0.3);
    }

    .btn:hover {
      transform: translateY(-3px);
      box-shadow: 0 8px 20px rgba(88, 166, 255, 0.5);
    }

    .btn-secondary {
      background: transparent;
      border: 2px solid var(--accent);
      color: var(--accent);
    }

    .btn-secondary:hover {
      background: var(--accent);
      color: white;
    }

    /* Features */
    .features {
      padding: 4rem 0;
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 2rem;
    }

    .card {
      background: var(--card);
      padding: 1.8rem;
      border-radius: 12px;
      border: 1px solid var(--border);
      transition: transform 0.3s;
    }

    .card:hover {
      transform: translateY(-8px);
      border-color: var(--accent);
    }

    .card h3 {
      font-family: 'JetBrains Mono', monospace;
      color: var(--accent);
      margin-bottom: 0.8rem;
      font-size: 1.3rem;
    }

    .card p {
      color: #8b949e;
      font-size: 0.95rem;
    }

    .code {
      background: #161b22;
      padding: 1rem;
      border-radius: 8px;
      font-family: 'JetBrains Mono', monospace;
      color: #79c0ff;
      margin: 1rem 0;
      overflow-x: auto;
      border: 1px solid var(--border);
    }

    /* Footer */
    footer {
      text-align: center;
      padding: 3rem 0;
      color: #8b949e;
      font-size: 0.9rem;
      border-top: 1px solid var(--border);
    }

    .heart {
      color: #da3633;
      animation: pulse 1.5s infinite;
    }

    @keyframes pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.2); }
    }

    /* Responsive */
    @media (max-width: 768px) {
      .hero h1 { font-size: 2.2rem; }
      .hero p { font-size: 1.1rem; }
      .logo { font-size: 2rem; }
    }

    /* Profiles Section */
    #profiles {
      padding: 4rem 0;
      min-height: 80vh;
      text-align: center;
      display: none; /* Скрываем по умолчанию, пока пользователь не нажмет "Найти пару" */
    }

    #profiles h2 {
      font-size: 2.5rem;
      margin-bottom: 2rem;
      color: var(--accent);
    }

    .profile-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 2rem;
      margin-top: 2rem;
    }

    .profile-card {
      background: var(--card);
      padding: 1.5rem;
      border-radius: 12px;
      border: 1px solid var(--border);
      text-align: left;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .profile-avatar {
      width: 120px;
      height: 120px;
      border-radius: 50%;
      border: 3px solid var(--accent);
      object-fit: cover;
      margin-bottom: 1rem;
    }

    .profile-card h3 {
      font-size: 1.5rem;
      margin-bottom: 0.5rem;
      color: var(--text);
      font-family: 'Inter', sans-serif;
    }

    .profile-bio {
      color: #8b949e;
      font-size: 0.95rem;
      margin-bottom: 1rem;
      text-align: center;
    }

    .action-buttons {
      display: flex;
      justify-content: space-around;
      width: 100%;
    }

    .action-buttons .btn {
      padding: 10px 20px;
      margin: 0;
      font-size: 1rem;
    }

    .btn-like {
      background: var(--green);
    }

    .btn-dislike {
      background: var(--red);
    }

  </style>
</head>
<body>

  <header>
    <div class="container">
      <div class="logo">Не баг<span>, а фича</span></div>
      <p class="tagline">Знакомства для тех, кто пишет код и любит мемы</p>
    </div>
  </header>

  <section class="hero">
    <div class="container">
      <h1>404: Love Not Found → 200: OK</h1>
      <p>Ты не странный. Ты <strong>feature-rich</strong>. Здесь твои баги — это суперсила.</p>
      <a href="#register" class="btn">Начать мэтчиться</a>
      <a href="#how" class="btn btn-secondary">Как это работает?</a>
    </div>
  </section>

  <section class="features">
    <div class="container">
      <div class="card">
        <h3>sudo hug me</h3>
        <p>Отправляй анонимные признания через Pull Request. Если ответили — merge в отношения!</p>
        <div class="code">$ curl -X LOVE https://api.nebagaficha.ru/hug/@anna</div>
      </div>

      <div class="card">
        <h3>Hotfix Date</h3>
        <p>Свидание на 1 час. Не зашло? <code>git revert</code>. Зашло? <code>git push --force</code> в любовь.</p>
      </div>

      <div class="card">
        <h3>Stack Overflow</h3>
        <p>Не знаешь, как сказать «нравишься»? Наш ИИ подскажет: <em>«Ты как useEffect без dependency array — запускаешься при каждом рендере моего сердца»</em></p>
      </div>

      <div class="card">
        <h3>Dark Mode Love</h3>
        <p>Ночной режим для тех, кто кодит до утра и ищет пару с таким же графиком.</p>
      </div>
    </div>
  </section>

  <section id="profiles">
    <div class="container">
      <h2>Кто еще ищет фичи?</h2>
      <div class="profile-grid">
        
        <div class="profile-card">
          <img src="https://avatars.githubusercontent.com/u/1024?v=4" alt="Аватар пользователя" class="profile-avatar">
          <h3>@LinusT</h3>
          <p class="profile-bio">
            Создатель, Лидер, Конфликтный Мерж. Ищу стабильную ветку. Хобби: рыбалка и <code>git blame</code>.
          </p>
          <div class="action-buttons">
            <button class="btn btn-like">Merge (Like)</button>
            <button class="btn btn-dislike">Revert (Dislike)</button>
          </div>
        </div>

        <div class="profile-card">
          <img src="https://avatars.githubusercontent.com/u/98681?v=4" alt="Аватар пользователя" class="profile-avatar">
          <h3>@GraceH</h3>
          <p class="profile-bio">
            Люблю функциональное программирование и чистый код. Ищу того, кто не будет ломать продакшен по пятницам.
          </p>
          <div class="action-buttons">
            <button class="btn btn-like">Merge (Like)</button>
            <button class="btn btn-dislike">Revert (Dislike)</button>
          </div>
        </div>
        
        </div>
    </div>
  </section>

  <section class="hero" id="register">
    <div class="container">
      <h2>Готов стать фичей?</h2>
      <p>Вход через GitHub — потому что <strong>твой код говорит о тебе больше, чем анкета</strong>.</p>
      <a href="https://fantastic-piroshki-8a73bc.netlify.app/.netlify/functions/github-auth" class="btn" role="button">Войти через GitHub</a>
      <p style="margin-top: 1rem; font-size: 0.9rem; color: #8b949e;">
        Скоро: регистрация по email, тесты на знание мемов и Vim-дуэли.
      </p>
    </div>
  </section>

  <footer>
    <div class="container">
      <p>© 2025 <strong>Не баг, а фича</strong> — Сделано с <span class="heart">любви</span> и <span style="color:#79c0ff">null</span></p>
      <p>Ты не одинок. Ты просто в <code>loading...</code> состоянии.</p>
    </div>
  </footer>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
        // --- Код Анимации ---
        const cards = document.querySelectorAll('.card');
        const observer = new IntersectionObserver((entries) => {
          entries.forEach(entry => {
            if (entry.isIntersecting) {
              entry.target.style.opacity = 1;
              entry.target.style.transform = 'translateY(0)';
            }
          });
        }, { threshold: 0.1 });

        cards.forEach(card => {
          card.style.opacity = 0;
          card.style.transform = 'translateY(20px)';
          card.style.transition = 'all 0.6s ease';
          observer.observe(card);
        });
        
        // --- Код Обработки Авторизации ---
        const heroSection = document.getElementById('register');
        const profilesSection = document.getElementById('profiles');
        const mainHero = document.querySelector('section.hero:not(#register)');
        
        function decodeJwt(token) {
            try {
                const base64Url = token.split('.')[1];
                const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
                const jsonPayload = decodeURIComponent(atob(base64).split('').map(function(c) {
                    return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
                }).join(''));
                return JSON.parse(jsonPayload);
            } catch (e) {
                return null;
            }
        }

        const params = new URLSearchParams(window.location.search);
        const token = params.get('token');
        const existingToken = localStorage.getItem('nebagaficha_token');
        
        let activeToken = null;

        if (token) {
            activeToken = token;
            localStorage.setItem('nebagaficha_token', token);
            window.history.replaceState({}, document.title, window.location.pathname);
        } else if (existingToken) {
            activeToken = existingToken;
        }


        if (activeToken && heroSection) {
            const userData = decodeJwt(activeToken);
            
            if (userData) {
                const username = userData.username || 'Тайный Кодер';
            
                // Обновление интерфейса
                heroSection.innerHTML = `
                    <div class="container">
                        <h2>Приветствуем, ${username}!</h2>
                        <p>Твой токен сохранен. Теперь ты можешь искать баги... то есть фичи.</p>
                        <button id="logoutBtn" class="btn btn-secondary">Выйти</button>
                        <a href="#profiles" id="findPairBtn" class="btn" style="margin-left: 1rem;">Найти пару</a>
                        <p style="margin-top: 1rem; font-size: 0.9rem; color: #8b949e;">
                            Удачного мэтча!
                        </p>
                    </div>
                `;
                
                // Добавление обработчика выхода (после создания кнопки)
                const logoutBtn = document.getElementById('logoutBtn');
                if (logoutBtn) {
                    logoutBtn.addEventListener('click', function() {
                        localStorage.removeItem('nebagaficha_token');
                        window.location.reload(); 
                    });
                }

                // --- ЛОГИКА НАВИГАЦИИ (добавлено id="findPairBtn") ---
                const findPairBtn = document.getElementById('findPairBtn');
                if (findPairBtn) {
                    findPairBtn.addEventListener('click', function(e) {
                        e.preventDefault(); 
                        
                        // Скрываем стартовый экран и показываем профили
                        if (profilesSection) profilesSection.style.display = 'grid'; 
                        if (heroSection) heroSection.style.display = 'none'; 
                        if (mainHero) mainHero.style.display = 'none';
                        
                        // Скролл к секции #profiles
                        if (profilesSection) profilesSection.scrollIntoView({ behavior: 'smooth' });
                    });
                }

            } else {
                 // Токен невалиден: удаляем и перезагружаем
                 localStorage.removeItem('nebagaficha_token');
                 if (!token) window.location.reload(); 
            }
        } else if (existingToken) {
            // Если мы авторизованы, но токена в URL нет (обычная загрузка), скрываем основной hero.
            if (mainHero) mainHero.style.display = 'none';
        }
    });

</script>
</body>
</html>